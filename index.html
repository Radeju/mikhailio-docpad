<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>

    <meta name="description" content="Software development using .NET, C#, SQL, Javascript and related technologies" />

    <title>Mikhail Shilkov</title>
    <meta name="author" content="Mikhail Shilkov">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="/feed/" rel="alternate" title="mikhail.io" type="application/atom+xml">
    <link href="/favicon.ico?v=2" rel="shortcut icon">

    <!-- Bootstrap -->
    <link href="/styles/site.css" rel="stylesheet" media="screen">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="/scripts/vendor/html5shiv.js"></script>
    <script src="/scripts/vendor/respond.min.js"></script>
    <![endif]-->

    <meta name="generator" content="DocPad v6.64.3" />
    
</head>
<body>

<div class="navbar navbar-default navbar-static-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">
                <span class="text-primary">Mikhail Shilkov</span><br />
                <span class="elevator-pitch">.NET, SQL and Javascript programmer</span>
            </a>
        </div>
        <div class="collapse navbar-collapse navbar-right">
            <ul class="nav navbar-nav">
                <!--<li><a href="/">Blog</a></li>-->
                
                <li><a href="/">Blog</a></li>
                <li><a href="/about">About</a></li>
                <li class="hidden-xs">
                    <a href="/feed/" class="rss"><span class="icon icon-feed"></span></a>
                    <a href="https://www.linkedin.com/in/mikhailshilkov" class="linkedin"><span class="icon icon-linkedin"></span></a>
                    <a href="http://twitter.com/kiwo22" class="twitter"><span class="icon icon-twitter"></span></a>
                    <a href="https://github.com/kiwo" class="github"><span class="icon icon-github"></span></a>
                </li>
            </ul>
            <form class="navbar-form navbar-right hidden-xs" role="search" action="http://google.com/search"
                  method="get">
                <div class="form-group">
                    <input type="search" name="q" class="form-control" placeholder="Search">
                    <input type="hidden" name="q" value="site:mikhail.io">
                </div>
            </form>
        </div>
    </div>
</div>
<div class="container">
    
    <article class="post">
    <div class="post-date">Oct 16th, 2014</div>
    
    <h1><a href='/2014/10/16/nice-way-to-kill-your-sql-server/'>Nice way to kill your SQL Server</a></h1>
    
    <div class="post-content">
        <p>Are you getting enormous amount of </p>
<pre><code>The activated proc &#39;...&#39; running on queue &#39;...&#39; output the following:
&#39;The service queue &quot;...&quot; is currently disabled.
</code></pre><p>errors from SQL Server? Keep on reading!</p>
<p>Yesterday, when I came back from my lunch, I got a heads-up from Windows:
<img src="/2014/10/16/nice-way-to-kill-your-sql-server//low-disk-space.gif" alt="Low disk space"></p>
<p>And it was literally out of space: 0 (zero) bytes available on C: drive. Wow...</p>
<p>I cleaned up the binary files from my developments, which gave me 3 GB of free space and some time to do the investigation. A short time, because disk space was counting down at about 300 MB per minute.</p>
<p>It appeared that the SQL Server error log files grew up to 53 GB and were still growing. Here is the default folder where you can find them:</p>
<p><img src="/2014/10/16/nice-way-to-kill-your-sql-server//errorlog.png" alt="SQL Server error log"></p>
<p>To gain more time, I executed the command</p>
<pre><code>exec sp_cycle_error
</code></pre><p>is Management Studio. It renames current ERRORLOG file to ERRORLOG.1 and starts the new current. So now it was safe to delete all .1/.2/etc files and get those 53 GB back. Huh...</p>
<p>Now it&#39;s time to figure out the actual issue. Go to Management Studio -&gt; your server -&gt; Management -&gt; SQL Server Logs -&gt; Current -&gt; (right click) -&gt; View SQL Server Log</p>
<p>I saw millions of the following messages there (let&#39;s say my queue is named XQueue for simplicity):</p>
<pre><code>The activated proc &#39;[dbo].[XQueueProcessor]&#39; running 
on queue &#39;dbo.XQueue&#39; output the following:
&#39;The service queue &quot;XQueue&quot; is currently disabled.
</code></pre><p>So, it looks like there is a problem with SQL Server Service Broker, which is constantly trying to read something from disabled queue. Isn&#39;t it supposed to stop after 5 attempts (a.k.a. poison messages)? Ok, keep on troubleshooting.</p>
<p>First, let check if the queue is actually disabled</p>
<pre><code>SELECT Name, is_receive_enabled, is_enqueue_enabled
  FROM sys.service_queues 
 WHERE Name = &#39;XQueue&#39;  
</code></pre><p>Yep, it&#39;s disabled:
<img src="/2014/10/16/nice-way-to-kill-your-sql-server//qdisabled.png" alt="XQueue disabled"></p>
<p>Do we have anything queued?</p>
<pre><code>SELECT TOP 1000 *
  FROM [XQueue] WITH(NOLOCK) 
</code></pre><p>I got 9 rows back. This means we got some messages en-queued, and one of them failed to process, the message was considered as poison and the queue was disabled (which is good), but the processor still seems to be running in eternal loop.</p>
<p>So, let&#39;s have a look at the processor. We had something like that:</p>
<pre><code>CREATE PROCEDURE [dbo].[XQueueProcessor]
AS
BEGIN
    DECLARE 
        @queuing_order BIGINT
        ,@conversation_handle UNIQUEIDENTIFIER
        ,@message_enqueue_time DATETIME
        ,@message_type_name VARCHAR(156)
        ,@message_body VARBINARY(MAX);

    WHILE(1=1) -- MAIN WHILE LOOP RECEIVING THE MESSAGE BATCHES
    BEGIN
        BEGIN TRANSACTION
        BEGIN TRY
            WAITFOR(RECEIVE TOP(1)
                        @queuing_order = [queuing_order],
                        @conversation_handle = [conversation_handle],
                        @message_enqueue_time = message_enqueue_time,
                        @message_type_name = message_type_name,
                        @message_body = message_body
                    FROM [dbo].[XQueue]), TIMEOUT 10

            IF (@@ROWCOUNT = 0)
            BEGIN
                ROLLBACK TRANSACTION
                BREAK
            END    

            -- SOME CRUD OPERATIONS HAPPEN HERE        

            COMMIT TRANSACTION
        END TRY
        BEGIN CATCH            
            DECLARE @Error varchar(4000) = ERROR_MESSAGE()
            PRINT @Error
            ROLLBACK TRANSACTION
        END CATCH        
    END
END
</code></pre><p>A-ha! So, what happens when an error occurs during the message processing? Control goes to CATCH block, error message is printed out (when we are in Service Broker, print goes directly to ERRORLOG file which we saw already), the transaction is rolled back... But we still are inside eternal loop, no BREAK or RETURN statement there, so the processor will try again to get the same message from the queue. After 5th attempt, the message will be marked as poison, the queue will get disabled, but the loop will keep running! The exception will change to &quot;The service queue is currently disabled&quot; and voila, CPU is busy and error logs are floating the disk.</p>
<p>The fix is pretty trivial, just change the CATCH block to</p>
<pre><code>BEGIN CATCH            
    DECLARE @Error varchar(4000) = ERROR_MESSAGE()
    PRINT @Error
    ROLLBACK TRANSACTION
    RETURN
END CATCH        
</code></pre><p>Be careful!</p>

    </div>

    <p>
      Like this post? Please share it!<br />
      <a href="https://twitter.com/share" class="twitter-share-button" data-via="mikhail.io" data-size="large" data-count="none">Tweet</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
    </p>

    See a mistake? <a href="https://github.com/kiwo/mikhailio-docpad/edit/master/src/documents/2014/10/16/nice-way-to-kill-your-sql-server/index.html.md">Edit this post!</a><br />

    
    <div class="post-tags">
        Posted In: Bugs, Error log, SQL Server, SQL Server Service Broker
    </div>
    
</article>

    <article class="post">
    <div class="post-date">Jun 3rd, 2014</div>
    
    <h1><a href='/2014/06/03/sql-produce-resultset-with-n-rows/'>SQL: produce resultset with N rows</a></h1>
    
    <div class="post-content">
        <p>Let&#39;s talk about T-SQL today.</p>
<p>Sometimes you need to produce a result set, which would contain N rows with numbers 1...N in each row. For example, I needed to calculate some statistics per week for N weeks starting from today and going back to the past.</p>
<p>Here is a table funtion which does the enumeration:</p>
<pre><code>CREATE FUNCTION dbo.fnEnumerateNumbers(@max int) 
RETURNS TABLE 
RETURN 
WITH
 E1(N) AS (SELECT 1 UNION ALL SELECT 1 UNION ALL SELECT 1 UNION ALL
           SELECT 1 UNION ALL SELECT 1 UNION ALL SELECT 1 UNION ALL
           SELECT 1 UNION ALL SELECT 1 UNION ALL SELECT 1 UNION ALL
           SELECT 1),                 --10E1  or 10 rows
 E2(N) AS (SELECT 1 FROM E1 a, E1 b), --10E2  or 100 rows
 E4(N) AS (SELECT 1 FROM E2 a, E2 b), --10E4  or 10000 rows
 E8(N) AS (SELECT 1 FROM E4 a, E4 b)  --10E8  or 100000000 rows
SELECT TOP (@max) N = ROW_NUMBER() OVER (ORDER BY (SELECT NULL)) 
  FROM E8
</code></pre><p>Usage is trivial:</p>
<pre><code>SELECT N
  FROM dbo.fnEnumerateNumbers(100)
</code></pre><p>And here is how I solved the task of enumerating weeks:</p>
<pre><code>SELECT dateadd(week, 1 - N, getutcdate()) 
  FROM dbo.fnEnumerateNumbers(100)
</code></pre><p>There are multiple possibilities to implement similar function, but I believe this way is the best one in terms of performance. No temporary tables, no table reads, no dependencies on table existance, and you can define your maximum yourself.</p>
<p>Happy coding!</p>

    </div>

    <p>
      Like this post? Please share it!<br />
      <a href="https://twitter.com/share" class="twitter-share-button" data-via="mikhail.io" data-size="large" data-count="none">Tweet</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
    </p>

    See a mistake? <a href="https://github.com/kiwo/mikhailio-docpad/edit/master/src/documents/2014/06/03/sql-produce-resultset-with-n-rows/index.html.md">Edit this post!</a><br />

    
    <div class="post-tags">
        Posted In: performance, SQL Server, T-SQL
    </div>
    
</article>

    <article class="post">
    <div class="post-date">May 21st, 2014</div>
    
    <h1><a href='/2014/05/21/sgen-to-precompile-classes-for-xmpserializer/'>Sgen to precompile classes for XmlSerializer</a></h1>
    
    <div class="post-content">
        <p>During my investigation of our ASP.NET application performance issue, I&#39;ve found out that XmlSerializer may require a long warm-up. The first time, when it&#39;s used for a specific class (de-)serialization, can take up to 500 ms om my machine! We use XmlSerializer to encode/decode user preferences. Having 40 different classes being deserialized at user login lead to a massive delay of 14 seconds. This is only for the first user login after the application start-up, but you do quite a lot of &#39;first times&#39; every day while developing the application.</p>
<p>These delays are caused by the runtime which prepares and compiles the strongly typed classes for serialization in runtime. Not sure why it&#39;s SO slow, but probably things might go wrong.</p>
<p>There is a simple solution for this problem: create those helper classes at build time, pack it into an assembly and ship it as part of your .NET application. The tool that does this is called Sgen.exe, and it is a part of .NET SDK. So, we just need to use it in our project.</p>
<p>The easiest way is to add a post-build event in your CS project properties. The event would look like</p>
<p><pre>sgen.exe /force /assembly:&quot;$(TargetPath)&quot;</pre>
After re-compiling the project, you should see a new assembly in Bin directory, which has the name ending with XmlSerializers.dll. That&#39;s the new assembly which will save you several seconds on each application start-up. It will be automatically copied to Bin directory of the projects which reference the original assembly with your serializable classes, so no other actions needed.</p>
<p>However, this command might fail. Sgen tool will try to prepare the helper classes for each class in your assembly, which might not be possible. Then you&#39;ll get some error messages in Visual Studio. In this case, you might want to add a &quot;/types&quot; parameter, explicitly listing the class names to precompile. But I have a better solution for you.</p>
<p>It&#39;s quite possible that you use MSBuild for regular automated builds of your project. We do. In this case a post-build event in the project properties won&#39;t work during those build. Then, do not add any post-build events, but instead open your .csproj file in plain text editor, and search for the following commented section:</p>
<pre><code>&lt;!-- To modify your build process, add your task inside one of the targets below and uncomment it. 
   Other similar extension points exist, see Microsoft.Common.targets.
&lt;Target Name=&quot;BeforeBuild&quot;&gt;
&lt;/Target&gt;
&lt;Target Name=&quot;AfterBuild&quot;&gt;
&lt;/Target&gt;
--&gt;
</code></pre><p>Uncomment the second XML node and substitute it with something like this:</p>
<pre><code>&lt;Target Name=&quot;AfterBuild&quot; DependsOnTargets=&quot;AssignTargetPaths;Compile;ResolveKeySource&quot; Inputs=&quot;$(MSBuildAllProjects);@(IntermediateAssembly)&quot; Outputs=&quot;$(OutputPath)$(_SGenDllName)&quot;&gt;
    &lt;ItemGroup&gt;
      &lt;SgenTypes Include=&quot;MyNamespace.MySerializableClass1&quot; /&gt;
      &lt;SgenTypes Include=&quot;MyNamespace.MySerializableClass2&quot; /&gt;
      &lt;SgenTypes Include=&quot;MyNamespace.MySerializableClassN&quot; /&gt;
    &lt;/ItemGroup&gt;
    &lt;Delete Files=&quot;$(TargetDir)$(TargetName).XmlSerializers.dll&quot; ContinueOnError=&quot;true&quot; /&gt;
    &lt;SGen BuildAssemblyName=&quot;$(TargetFileName)&quot; BuildAssemblyPath=&quot;$(OutputPath)&quot; References=&quot;@(ReferencePath)&quot; ShouldGenerateSerializer=&quot;true&quot; UseProxyTypes=&quot;false&quot; KeyContainer=&quot;$(KeyContainerName)&quot; KeyFile=&quot;$(KeyOriginatorFile)&quot; DelaySign=&quot;$(DelaySign)&quot; ToolPath=&quot;$(SGenToolPath)&quot; Types=&quot;@(SgenTypes)&quot;&gt;
      &lt;Output TaskParameter=&quot;SerializationAssembly&quot; ItemName=&quot;SerializationAssembly&quot; /&gt;
    &lt;/SGen&gt;
&lt;/Target&gt;
</code></pre><p>The ItemGroup lists all the classes that you need to precompile. You can omit this section and Types attribute of SGen node if you want to compile all classes in assembly.
Have a nice application start-up boost!</p>

    </div>

    <p>
      Like this post? Please share it!<br />
      <a href="https://twitter.com/share" class="twitter-share-button" data-via="mikhail.io" data-size="large" data-count="none">Tweet</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
    </p>

    See a mistake? <a href="https://github.com/kiwo/mikhailio-docpad/edit/master/src/documents/2014/05/21/sgen-to-precompile-classes-for-xmpserializer/index.html.md">Edit this post!</a><br />

    
    <div class="post-tags">
        Posted In: .NET, ASP.NET, C#, debugging, MSBuild, performance, Sgen, XmlSerializer
    </div>
    
</article>

    <article class="post">
    <div class="post-date">Jan 6th, 2013</div>
    
    <h1><a href='/2013/01/06/poker-money-application-for-windows-store/'>Poker Money application for Windows Store</a></h1>
    
    <div class="post-content">
        <p>Windows 8 / Windows RT / Windows Store all arrived in October 2012.</p>
<p>I&#39;ve decided to take a shot on writing a commercial application for this new platform. And that&#39;s how Poker Money app appeared.</p>
<p>Here are the links to it:</p>
<p><a href="http://pokermoneyapp.com" title="Poker money app official website">Poker Money app official website</a></p>
<p><a href="http://apps.microsoft.com/windows/ru-RU/app/poker-money/47c61b67-94ec-4aae-a9c4-f60a37d7cc03" title="Poker Money in Windows Store">Windows Store application page</a></p>
<p><a href="http://forumserver.twoplustwo.com/45/software/poker-money-app-1282491/" title="Support thread for Poker Money">Support thread on 2+2</a></p>
<p>Poker Money is a basic tool for tracking online poker results, which supports all game types for the two major poker rooms: PokerStars and FullTiltPoker.</p>
<p>Here is a sample screen:
<img src="/2013/01/06/poker-money-application-for-windows-store//pokermoneyapp-screen.png" alt="Poker Money app on Windows 8"></p>

    </div>

    <p>
      Like this post? Please share it!<br />
      <a href="https://twitter.com/share" class="twitter-share-button" data-via="mikhail.io" data-size="large" data-count="none">Tweet</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
    </p>

    See a mistake? <a href="https://github.com/kiwo/mikhailio-docpad/edit/master/src/documents/2013/01/06/poker-money-application-for-windows-store/index.html.md">Edit this post!</a><br />

    
    <div class="post-tags">
        Posted In: Full Tilt Poker, Poker, Poker Money, Poker Money application, Poker Stars, Windows 8, Windows RT, Windows Store
    </div>
    
</article>

    <article class="post">
    <div class="post-date">Dec 26th, 2012</div>
    
    <h1><a href='/2012/12/26/one-certificate-missing-one-received-unexpectedly/'>One certificate missing, one received unexpectedly</a></h1>
    
    <div class="post-content">
        <p>Today I want to give a note about two more online courses that I completed.</p>
<p>The last one (10 weeks in September-November) was called <a href="https://www.coursera.org/course/compfinance">Introduction to Computational Finance and Financial Econometrics</a> and was lead by Eric Zivot from University of Washington. First of all, it was the most intense course out of all that I took to date. Every of 10 weeks we had about 3-4 hours of videos + homework. The course material was mostly about maths and statistics, and less about application in economics. However, some concepts were new to me and sounded very interesting.</p>
<p>I scored about 95% on all tests and exams (they were relatively easy comparing to video material). But unfortunately, I got no certificate or even course record for this! It seems that University of Washington did not allow Coursera to issue such certificates and records... What a shame! I spent lots of time on it, and a record would be satisfactory. Please be careful if you take this course or other courses of UoW in the future.</p>
<p>However, I got another unexpected certificate. In June, I took a course called <a href="https://www.coursera.org/course/hci">Human-Computer Interaction</a> about user interface design concepts and approaches. I started it with a big delay because of my vacation, so I thought I wouldn&#39;t score enough for a certificate. But I was wrong! I got the certificate 6 months after the course ended:
<img src="/2012/12/26/one-certificate-missing-one-received-unexpectedly//hci.jpg" alt="HCI certificate"></p>
<p>The course was short but useful. I wish there would be an extension course, which would cover more details on the topic.</p>

    </div>

    <p>
      Like this post? Please share it!<br />
      <a href="https://twitter.com/share" class="twitter-share-button" data-via="mikhail.io" data-size="large" data-count="none">Tweet</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
    </p>

    See a mistake? <a href="https://github.com/kiwo/mikhailio-docpad/edit/master/src/documents/2012/12/26/one-certificate-missing-one-received-unexpectedly/index.html.md">Edit this post!</a><br />

    
    <div class="post-tags">
        Posted In: Coursera, Online Classes, Online Learning, Statement of Accomplishment
    </div>
    
</article>

    <article class="post">
    <div class="post-date">Nov 1st, 2012</div>
    
    <h1><a href='/2012/11/01/finance-class-at-coursera/'>Introduction to Finance class at Coursera</a></h1>
    
    <div class="post-content">
        <p>I&#39;ve recently received a statement of accomplishment document for <a href="https://www.coursera.org/" title="Coursera">Coursera</a>&#39;s online <a href="https://www.coursera.org/course/introfinance" title="Introduction to Finance class">Introduction to Finance class</a> that I took in July-September this year.</p>
<p><img src="/2012/11/01/finance-class-at-coursera//finance.jpg" alt="Finance"></p>
<p>The course was lead by prof. Gautam Kaul from University of Michigan. The level of lectures was really introductory, the pace was very slow (too slow for me, even watching x1.5 speed). You could learn about basic finance principles like time value of money, calculating cash flows and discounted values, about stocks and bonds, and risk/return relations.</p>
<p>I liked a lot the assignment tests, which were much stronger and solid then the examples in lectures. They were challenging most of the time, so I&#39;m glad I managed to get 100% score in the end :)</p>
<p>Recommended for anyone who has no idea about what finance is about, but not for experienced students.</p>

    </div>

    <p>
      Like this post? Please share it!<br />
      <a href="https://twitter.com/share" class="twitter-share-button" data-via="mikhail.io" data-size="large" data-count="none">Tweet</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
    </p>

    See a mistake? <a href="https://github.com/kiwo/mikhailio-docpad/edit/master/src/documents/2012/11/01/finance-class-at-coursera/index.html.md">Edit this post!</a><br />

    
    <div class="post-tags">
        Posted In: Coursera, finance, Online Classes, Online Learning, Statement of Accomplishment
    </div>
    
</article>

    <article class="post">
    <div class="post-date">Oct 29th, 2012</div>
    
    <h1><a href='/2012/10/29/gamification-class-at-coursera/'>Gamification class at Coursera</a></h1>
    
    <div class="post-content">
        <p>I&#39;ve recently received a statement of accomplishment document for <a href="https://www.coursera.org/" title="Coursera">Coursera</a>&#39;s online <a href="https://www.coursera.org/course/gamification" title="Gamification class">Gamification class</a> that I took in August-October this year.</p>
<p><img src="/2012/10/29/gamification-class-at-coursera//gamification.jpg" alt="Gamification certificate" title="Gamification certificate"></p>
<p>The course was lead by prof. Kevin Werbach from The Wharton School, University of Pennsylvania. He told us about applying game techniques to non-game world problems: business, social etc. In essence, it&#39;s on how to add FUN to processes, that are not supposed to be fun at all. Which is really cool. I loved both informative and well-producted lectures, and peer-reviewed assignments that appeared to be... fun :)</p>
<p>Want to know why Stackoverflow and Foursquare are such a success? Come join this course next time!</p>
<p>I hope I&#39;ll have a chance to apply the ideas from the course in real life!</p>

    </div>

    <p>
      Like this post? Please share it!<br />
      <a href="https://twitter.com/share" class="twitter-share-button" data-via="mikhail.io" data-size="large" data-count="none">Tweet</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
    </p>

    See a mistake? <a href="https://github.com/kiwo/mikhailio-docpad/edit/master/src/documents/2012/10/29/gamification-class-at-coursera/index.html.md">Edit this post!</a><br />

    
    <div class="post-tags">
        Posted In: Coursera, gamification, Online Classes, Online Learning, Statement of Accomplishment
    </div>
    
</article>

    <article class="post">
    <div class="post-date">Sep 2nd, 2012</div>
    
    <h1><a href='/2012/09/02/use-fiddler-to-debug-urlfetch-requests-in-google-appengine/'>Use Fiddler to debug urlfetch requests in Google AppEngine</a></h1>
    
    <div class="post-content">
        <p>In <a href="http://www.tripbenefit.com" title="TripBenefit.com - travel in St. Petersburg, Russia">TripBenefit</a> application, we use a lot of web crawling to get data from third-party websites. As the application works on top of Google AppEngine, the <a href="https://developers.google.com/appengine/docs/python/urlfetch/fetchfunction?hl=ru" title="urlfetch.fetch() docs">urlfetch.fetch()</a> function is used to send HTTP requests and get responses.</p>
<p>Some crawling is not as easy as just a simple GET request, so we have to send specific POST data, cookies and HTTP headers. And all this needs to be debugged. <a href="http://www.fiddler2.com" title="Fiddler2 web debugging tool">Fiddler2</a> is the gold standard for web debugging tools, so I&#39;d like to use it in this case too. I.e. I want to see urlfetch requests displayed in Fiddler, while I&#39;m on development env.<strong>
</strong></p>
<p>However, to make it work, I have to make AppEngine run all fetch requests through the Fiddler&#39;s proxy: localhost:8888. As proxies aren&#39;t supported within Google production environment, it&#39;s not supported by development engine either. There&#39;s simply no such &#39;proxy&#39; parameter in urlfetch!</p>
<p>It seems that the only way to overcome this limitation is to modify the code of AppEngine development server. It isn&#39;t that tricky as it sounds! :)</p>
<p>Stop all your developmenet AppEngine instances. Go to your AppEngine folder, and then to \google\appengine\api. Edit urlfetch_stub.py (make a backup beforehand). Search for &quot;connection =&quot; line, something like</p>
<pre><code>if _CONNECTION_SUPPORTS_TIMEOUT:
  connection = connection_class(host, timeout=deadline)
else:
  connection = connection_class(host)
</code></pre><p>Substitute it with </p>
<pre><code>connection = connection_class(&#39;127.0.0.1&#39;, 8888)
</code></pre><p>Then, search for &quot;connection.request&quot; method call similar to</p>
<pre><code>connection.request(method, full_path, payload, adjusted_headers)
</code></pre><p>and insert another line before it:</p>
<pre><code>full_path = protocol + &quot;://&quot; + host + full_path
</code></pre><p>Done! After you run the dev server and Fiddler2, you should be able to see urlfetch requests in web debugger. Have a nice debugging session!</p>

    </div>

    <p>
      Like this post? Please share it!<br />
      <a href="https://twitter.com/share" class="twitter-share-button" data-via="mikhail.io" data-size="large" data-count="none">Tweet</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
    </p>

    See a mistake? <a href="https://github.com/kiwo/mikhailio-docpad/edit/master/src/documents/2012/09/02/use-fiddler-to-debug-urlfetch-requests-in-google-appengine/index.html.md">Edit this post!</a><br />

    
    <div class="post-tags">
        Posted In: AppEngine, debugging, Fiddler, Google AppEngine, Python
    </div>
    
</article>

    <article class="post">
    <div class="post-date">Aug 14th, 2012</div>
    
    <h1><a href='/2012/08/14/google-adds-public-transit-into-api/'>Google adds Public Transit into API</a></h1>
    
    <div class="post-content">
        <p>Now, both Google Directions Web Services and Google Maps JavaScript API include building the routes with Public Transit.</p>
<p>Blog post:</p>
<p><a href="http://googlegeodevelopers.blogspot.com/2012/06/public-transit-routing-and-layer-now.html">http://googlegeodevelopers.blogspot.com/2012/06/public-transit-routing-and-layer-now.html</a></p>
<p>API docs:</p>
<p><a href="https://developers.google.com/maps/documentation/directions/#TravelModes">https://developers.google.com/maps/documentation/directions/#TravelModes</a></p>
<p><a href="https://developers.google.com/maps/documentation/javascript/directions#TransitOptions">https://developers.google.com/maps/documentation/javascript/directions#TransitOptions</a></p>
<p>Sample request in St. Petersburg:</p>
<p><a href="http://maps.googleapis.com/maps/api/directions/json?origin=59.94473,30.294254&amp;destination=59.80612,30.308552&amp;sensor=false&amp;departure_time=1346197500&amp;mode=transit">http://maps.googleapis.com/maps/api/directions/json?origin=59.94473,30.294254&amp;destination=59.80612,30.308552&amp;sensor=false&amp;departure_time=1346197500&amp;mode=transit</a></p>

    </div>

    <p>
      Like this post? Please share it!<br />
      <a href="https://twitter.com/share" class="twitter-share-button" data-via="mikhail.io" data-size="large" data-count="none">Tweet</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
    </p>

    See a mistake? <a href="https://github.com/kiwo/mikhailio-docpad/edit/master/src/documents/2012/08/14/google-adds-public-transit-into-api/index.html.md">Edit this post!</a><br />

    
    <div class="post-tags">
        Posted In: Google Maps, Google Transit
    </div>
    
</article>

    <article class="post">
    <div class="post-date">Jul 26th, 2012</div>
    
    <h1><a href='/2012/07/26/enable-jinja2-and-i18n-translations-on-google-appengine/'>Enable jinja2 and i18n translations on Google AppEngine</a></h1>
    
    <div class="post-content">
        <p>My initial goal was to make our new application (based on python/AppEngine) translatable. This means the following requirements:</p>
<ol>
<li>All strings in the application must be translatable</li>
<li>Translations should preferably stored in separate files</li>
<li>It should be easy to use the translations both in .py files and html templates</li>
</ol>
<p>The solution that I came to after a couple of hours includes the following components: Babel (string file generation), i18n.gettext (getting strings in code) and jinja2 &lt;% trans %&gt; tag (getting strings in templates). The setup of all this is not obvious, so I&#39;ll put the steps in this blog post. Let&#39;s start!</p>
<ol>
<li><p>Intall Babel: <a href="http://babel.edgewall.org/">http://babel.edgewall.org/</a></p>
<p> You need to install it, not just ref from the application, as you&#39;ll need its comman &#39;pybabel&#39; to generate locale-specific files. I use Windows, so I just downloaded the installation package.</p>
<p> Make sure that Python folders are in your PATH variable. I use Python 2.7, so to make Babel work I&#39;ll need the following values in PATH: &quot;C:\Python27;C:\Python27\Scripts&quot;. Scripts folder contains the pybabel executable.</p>
</li>
<li><p>Install jinja2: <a href="http://jinja.pocoo.org/">http://jinja.pocoo.org</a>
Once again, you need to install it, as Babel will need it to parse strings in templates. Just run</p>
<pre><code> easy_install Jinja2
</code></pre></li>
<li><p>Put Babel and <a href="http://pypi.python.org/pypi/gaepytz">gaepytz</a> libraries inside your GAE application. They are required for i18n module.</p>
</li>
<li><p>Configure jinja2 to be used in your application. You&#39;ll need the following entry in app.yaml:</p>
<pre><code> libraries:
 - name: jinja2
   version: &quot;2.6&quot;
</code></pre><p> and your webhandler.py will look something similar to this:</p>
<pre><code> import webapp2
 from webapp2_extras import jinja2
 from webapp2_extras import i18n
 from google.appengine.ext.webapp.util import run_wsgi_app

 class MainHandler(webapp2.RequestHandler):
     @webapp2.cached_property
     def jinja2(self):
         return jinja2.get_jinja2(app=self.app)

     def get(self):
         i18n.get_i18n().set_locale(&#39;ru_RU&#39;) # sample locale assigned
         ... # your web site functionality goes here

 # jinja2 config with i18n enabled
 config = {&#39;webapp2_extras.jinja2&#39;: {
              &#39;template_path&#39;: &#39;templates&#39;,
              &#39;environment_args&#39;: { &#39;extensions&#39;: [&#39;jinja2.ext.i18n&#39;] }
            }
           }
 application = webapp2.WSGIApplication([(&#39;.*&#39;, MainHandler)], config=config)

 def main():
     run_wsgi_app(application)

 if __name__ == &quot;__main__&quot;:
     main()
</code></pre><p> This code will work if you put your jinja2 templates into &quot;templates&quot; folder.</p>
</li>
<li><p>Create the translations markup. This means, you define the translatable strings in python code with a commonly used &#39;_&#39; alias:</p>
<pre><code> from webapp2_extras.i18n import gettext as _

 def do_some_text():
     return _(&#39;some text&#39;)
</code></pre><p> or in jijna2 template with {% trans %} block:</p>
<pre><code> {% block buttons %}
 &lt;div&gt;    
     &lt;div onclick=&quot;window.print()&quot;&gt;{% trans %}Print{% endtrans %}&lt;/div&gt;
 &lt;/div&gt;
 {% endblock %}
</code></pre></li>
<li><p>Create a Babel configuration file babel.cfg (put it into the application folder for now):</p>
<pre><code> [jinja2: **/templates/**.html]
 encoding = utf-8
 [python: source/*.py]
 [extractors] 
 jinja2 = jinja2.ext:babel_extract
</code></pre><p> This file instructs Babel to extract translatable strings from html jinja2 templates in &quot;templates&quot; folder and python files in &quot;source&quot; folder. </p>
</li>
<li><p>Now it&#39;s time to create translations. First, add a &quot;locale&quot; folder in application root. Still being in root folder, run the following pybabel command to extract the translatable strings from the code</p>
<pre><code> pybabel extract -F ./babel.cfg -o ./locale/messages.pot ./
</code></pre><p> then initialize the locales with </p>
<pre><code> pybabel init -l en_US -d ./locale -i ./locale/messages.pot
 pybabel init -l ru_RU -d ./locale -i ./locale/messages.pot
</code></pre><p> Now open locale\ru_RU\LC_MESSAGES\messages.po file in your favorite text editor, and produce the translations (you have to change &#39;msgstr&#39; only):</p>
<pre><code> #: templates/sample.html:10
 msgid &quot;Print&quot;
 msgstr &quot;Печать&quot;
 #: source/test.py:13
 msgid &quot;some text&quot;
 msgstr &quot;немного текста&quot;
</code></pre><p> And finally compile the texts with</p>
<pre><code> pybabel compile -f -d ./locale
</code></pre></li>
<li><p>Every time you need to add more strings, you should do the same steps as in 6, but use &quot;update&quot; instead of &quot;init&quot;:</p>
<pre><code> pybabel update -l en_US -d ./locale -i ./locale/messages.pot
 pybabel update -l ru_RU -d ./locale -i ./locale/messages.pot
</code></pre></li>
</ol>
<p>Done! You should be able to run the application and see the strings translated.</p>

    </div>

    <p>
      Like this post? Please share it!<br />
      <a href="https://twitter.com/share" class="twitter-share-button" data-via="mikhail.io" data-size="large" data-count="none">Tweet</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
    </p>

    See a mistake? <a href="https://github.com/kiwo/mikhailio-docpad/edit/master/src/documents/2012/07/26/enable-jinja2-and-i18n-translations-on-google-appengine/index.html.md">Edit this post!</a><br />

    
    <div class="post-tags">
        Posted In: AppEngine, i18n, jinja2, Python, Translations
    </div>
    
</article>

    <article class="post">
    <div class="post-date">Jun 21st, 2012</div>
    
    <h1><a href='/2012/06/21/model-thinking-class-at-coursera/'>Model Thinking class at Coursera</a></h1>
    
    <div class="post-content">
        <p>I&#39;ve recently received a statement of accomplishment document for <a href="https://www.coursera.org/" title="Coursera">Coursera</a>&#39;s online <a href="https://www.coursera.org/course/modelthinking" title="Model Thinking Class">Model Thinking Class</a> that I took in April-May this year.</p>
<p><img src="/2012/06/21/model-thinking-class-at-coursera//modelthinking.jpg" alt="Model Thinking" title="Model Thinking"></p>
<p>The course was kind of short but very intense, with a broad variety of models reviewed and many many very cool examples of models applied to real-world processes like population segregation, economic growth, disease spread, auctions and sport results. Scott E Page is a cool teacher who knows how to explain things in simple words and speaks very fast :)</p>
<p>Thanks to Scott E and University of Michigan. Sign up for more courses coming at <a href="/2012/06/21/model-thinking-class-at-coursera/Coursera" title="Coursera">Coursera</a>!</p>

    </div>

    <p>
      Like this post? Please share it!<br />
      <a href="https://twitter.com/share" class="twitter-share-button" data-via="mikhail.io" data-size="large" data-count="none">Tweet</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
    </p>

    See a mistake? <a href="https://github.com/kiwo/mikhailio-docpad/edit/master/src/documents/2012/06/21/model-thinking-class-at-coursera/index.html.md">Edit this post!</a><br />

    
    <div class="post-tags">
        Posted In: Coursera, Model Thinking, Online Classes, Online Learning, Statement of Accomplishment
    </div>
    
</article>

    <article class="post">
    <div class="post-date">May 17th, 2012</div>
    
    <h1><a href='/2012/05/17/api-to-get-the-list-of-hotels/'>API to get the list of hotels</a></h1>
    
    <div class="post-content">
        <p>In our travelling application, we need to show the list of hotels in a city (St. Petersburg, Russia at the moment, but more will be needed in the future). The idea was to find a hotel information provider, and then upload the complete list into our own database. The following info is needed for each hotel:</p>
<ul>
<li>Name in English</li>
<li>Location (latitude / longitude)</li>
<li>An image would be nice</li>
<li>Probably, some sort of rating
We started with <a href="http://www.booking.com/index.html?aid=352212" title="Booking.com">Booking.com</a>, which does have API, but the API is NOT public, and one has to provide website/bank account information to become an affiliate and get the access.</li>
</ul>
<p>Then, I had a try with <a href="http://GeoNames.org" title="GeoNames.org">GeoNames.org</a>, which I once used for the list of populated localities in Europe. Unfortunately, the POI list in Russia is quite poor there.</p>
<p>We had next try with <a href="http://www.openstreetmap.org" title="OpenStreetMap">OpenStreetMap</a> data. I&#39;ve downloaded a 7 GB XML file with POIs of Russia. But I got disappointed once again after parsing it: only about 100 hotels in St. Petersburg + most names are in Russian.</p>
<p>Finally, we&#39;ve found the solution. <a href="http://www.hotelscombined.com/?a_aid=61901" title="HotelsCombined">HotelsCombined</a> has an easy-to-access and useful service to download the data feed files with hotels. 590 hotels in St. Petersburg - good enough! Here is how you get it:</p>
<ol>
<li>Go to <a href="http://www.hotelscombined.com/Affiliates.aspx">http://www.hotelscombined.com/Affiliates.aspx</a></li>
<li>Register there (no company or bank data is needed)</li>
<li>Open &quot;Data feeds&quot; page</li>
<li>Choose &quot;Standard data feed&quot; -&gt; &quot;Single file&quot; -&gt; &quot;CSV format&quot; (you may get XML as well)</li>
</ol>
<p>Parsing the CSV file is a piece of cake, here is a sample Python code to filter out hotels from St. Petersburg:</p>
<pre><code>def filter_hotels(from_file):
    with open(from_file, &#39;r&#39;) as fr:
        while True:
            line = fr.readline()
            if len(line) == 0:
                break # EOF
            hotel = line.split(&#39;,&#39;)
            city_code = hotel[5]
            country_code = hotel[10]
            if city_code == &#39;St_Petersburg&#39; and country_code == &#39;RU&#39;:
                hotel_name = hotel[2]
                print hotel_name
</code></pre><p>Here is the complete list of fields in CSV/XML:</p>
<pre><code>hotelId, hotelFileName, hotelName, rating, cityId, cityFileName, cityName, stateId, stateFileName, stateName, countryCode, countryFileName, countryName, imageId, address, minRate, currencyCode, Latitude, Longitude, NumberOfReviews, ConsumerRating, PropertyType, ChainID, Facilities
</code></pre><p><strong>Update:</strong> Unfortunately, HotelsCombined.com has introduced the new regulations: they&#39;ve restricted the access to data feeds by default. To get the access, a partner must submit some information on why one needs the data. The HC team will review it and then (maybe) will grant access. Sad but true. I&#39;m in the middle of getting through this guarg, I&#39;ll let you know about the result.</p>
<p><strong>Update 2:</strong> Yes, we got the access to data feeds again. After reviewing the application form, HotelsCombined asked us to let them know our IP, white-listed it and now we can download the files. Still, I don&#39;t know why they need all this procedure at all.</p>

    </div>

    <p>
      Like this post? Please share it!<br />
      <a href="https://twitter.com/share" class="twitter-share-button" data-via="mikhail.io" data-size="large" data-count="none">Tweet</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
    </p>

    See a mistake? <a href="https://github.com/kiwo/mikhailio-docpad/edit/master/src/documents/2012/05/17/api-to-get-the-list-of-hotels/index.html.md">Edit this post!</a><br />

    
    <div class="post-tags">
        Posted In: Hotels API, HotelsCombined, Public API, Python
    </div>
    
</article>

    <article class="post">
    <div class="post-date">May 16th, 2012</div>
    
    <h1><a href='/2012/05/16/books-that-ive-recently-read-part-2/'>Books that I’ve recently read, part 2</a></h1>
    
    <div class="post-content">
        <p><img src="/2012/05/16/books-that-ive-recently-read-part-2//rework3.jpg" alt="Rework" title="rework"><strong>&quot;Rework&quot;</strong> by Jason Fried and David Heinemeier Hansson (<a href="http://www.amazon.com/Rework-Jason-Fried/dp/0307463745" title="Rework book">link</a>)</p>
<p>Short but practical and inspiring  entrepreneurial handbook for the twenty-first century. The guys from <a href="http://37signals.com/" title="37 signals">37signals</a> give no boring theory but dozens of useful hints for a business &quot;starter&quot;.</p>
<p>The book is not deap, just a &#39;one-evening-reading&#39;. And the advice they give is quite the opposite to what people teach in business schools.</p>
<p>Great reading for those who want to start their own business, have their own business, or are just interested in the subject. But don&#39;t believe them blind. Score is 4 of 5.</p>
<p><img src="/2012/05/16/books-that-ive-recently-read-part-2//krug.png" alt="Krug" title="krug"></p>
<p><strong>&quot;Don&#39;t Make Me Think&quot;</strong> by Steve Krug (<a href="http://www.amazon.com/exec/obidos/ASIN/0789723107" title="Don">link</a>)</p>
<p>A very well laid introduction into web site usability. Steve gives several generic rules (&quot;the Krug&#39;s laws&quot;) on how to get into user&#39;s head, how to think usability, how to make pages clear, understandable and consise. Also be ready to good humor and excellent illustrations.</p>
<p>This book may seem old (first published in 2000) but the rules are still up-to-date, and the book became an industry standard. Must-read for software developers, product managers and everyone who&#39;s job is related to web site creation.</p>
<p>Score is 5.</p>
<p><img src="/2012/05/16/books-that-ive-recently-read-part-2//nondesigner.jpg" alt="Non-designer" title="Non-designer"> <strong>&quot;The Non-Designer&#39;s Design Book&quot;</strong> by Robin Williams (<a href="http://www.amazon.com/exec/obidos/ASIN/0321193857" title="The Non-Designer">link</a>)</p>
<p>I&#39;m far from being a good designer but I&#39;d really love to get at least the very basics of the skill to make beautiful things (UI mostly).</p>
<p>The author of this book explains some really generic principles of design, i.e. contrast, repetition, alignment, proximity and proper font usage. She gives the clear overview of each principle and provides examples and exercises to illustrate them.</p>
<p>We&#39;ll see whether the book will help me build good-looking web pages... In any case, it&#39;s absolutely worth reading for persons who have interest in the subject.</p>
<p><img src="/2012/05/16/books-that-ive-recently-read-part-2//toiletpaperentrepreneur.jpg" alt="" title="toiletpaperentrepreneur"> <strong>&quot;The Toilet Paper Entrepreneur&quot;</strong> by Mike Michaliwicz (<a href="http://www.toiletpaperentrepreneur.com/book/overview/" title="The Toilet paper entrepreneur">link</a>)</p>
<p>The book is about running a startup without any significant budget available.</p>
<p>To me, this book is mostly about motivation and call to action. Stop crying about not having this or that. Don&#39;t wait for a million to come before you start your business. Just start today and work hard!</p>
<p>Otherwise, I don&#39;t think I&#39;ll take much of Mike&#39;s advice. Score is 3 of 5.</p>

    </div>

    <p>
      Like this post? Please share it!<br />
      <a href="https://twitter.com/share" class="twitter-share-button" data-via="mikhail.io" data-size="large" data-count="none">Tweet</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
    </p>

    See a mistake? <a href="https://github.com/kiwo/mikhailio-docpad/edit/master/src/documents/2012/05/16/books-that-ive-recently-read-part-2/index.html.md">Edit this post!</a><br />

    
    <div class="post-tags">
        Posted In: Books, Business books
    </div>
    
</article>

    <article class="post">
    <div class="post-date">Apr 10th, 2012</div>
    
    <h1><a href='/2012/04/10/google-transit-api-research/'>Google Transit API research</a></h1>
    
    <div class="post-content">
        <p>Recently, Google has launch a Transit service for the biggest cities of Russia: a service to caculate routes with public transport options. As a part of RnD for upcoming project, I need to understand whether there&#39;s any feasible way to calculate public transport route programmatically. I.e. I need Google Transit API.</p>
<p>Here&#39;s what I&#39;ve got so far:</p>
<ol>
<li><p>There&#39;s no official Google Transit API at the momemnt. Transit feeds are provided by third party agencies, and most of those feeds are not public. So, Google is not allowed to open them as API.</p>
</li>
<li><p>You may try to consume the &quot;unofficial&quot; API using the following sample link:
<a href="http://maps.google.com/?saddr=St.%20Petersburg%20Shavrova%2013&amp;daddr=St.%20Petersburg%20Sadovaya%2032&amp;dirflg=r&amp;output=json" title="Sample Google Transit JSON result">http://maps.google.com/?saddr=St.%20Petersburg%20Shavrova%2015&amp;daddr=St.%20Petersburg%20Sadovaya%2030&amp;dirflg=r&amp;output=json</a></p>
</li>
<li><p>However, the result won&#39;t be a valid JSON. Instead, that&#39;s something, that can be easily converted to a JavaScript object. (The differences are: there is no quotes around property names, the strings are not properly encoded etc.)</p>
</li>
<li><p>Imagine you got this JavaScript object. However, it won&#39;t allow you to easily get the structured route details. Object&#39;s properties contain the route points coordinates, but no descriptions. The only place where the descriptions may be found is &#39;panel&#39; property, which contains a chunk of HTML text (sample <a href="https://skydrive.live.com/redir.aspx?cid=c010011792a4b538&amp;resid=C010011792A4B538!129&amp;parid=C010011792A4B538!124&amp;authkey=!AEzvBnLErMyVDbo" title="Sample HTML of ">here</a>).</p>
</li>
<li><p>So, you&#39;ll have to convert this HTML into XML (X-HTML) and then build the parser of this XML to get the essence data of a trip.</p>
</li>
</ol>
<p>Seems like a bit of overkill to me. Having in mind, that &quot;unofficial&quot; API may change in the future, including slight changes in &#39;panel&#39; HTML structure that will kill your parser.</p>
<p>Also, I&#39;m still not sure whether I can change the language of route directions.</p>
<p><strong>Update</strong>: language is specified with &quot;hl&quot; request parameter.</p>
<p><strong>Update 2</strong>: <a href="http://mikhail.io/2012/08/14/google-adds-public-transit-into-api/">Google Transit API is now available</a>!</p>

    </div>

    <p>
      Like this post? Please share it!<br />
      <a href="https://twitter.com/share" class="twitter-share-button" data-via="mikhail.io" data-size="large" data-count="none">Tweet</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
    </p>

    See a mistake? <a href="https://github.com/kiwo/mikhailio-docpad/edit/master/src/documents/2012/04/10/google-transit-api-research/index.html.md">Edit this post!</a><br />

    
    <div class="post-tags">
        Posted In: API, Google Maps, Google Transit
    </div>
    
</article>

    <article class="post">
    <div class="post-date">Mar 13th, 2012</div>
    
    <h1><a href='/2012/03/13/multi-level-teleriks-tileview/'>Multi-level telerik's TileView</a></h1>
    
    <div class="post-content">
        <p>We were investigating the options for visual representation of hierarchical dashboard in our Silverlight application. This means, we want to display the number of gauges with tree-like structure. Here is a sample:
Dashboard</p>
<pre><code>--- Fuel economy index
------ Preventative driving
--------- Accelaration style
--------- Braking frequency
--------- Stop approach
------ Gear shifting index
--------- ...
--- Degree of difficulty
------ ...
--- Events
------ ......
</code></pre><p>One of the options was to use <a href="http://www.telerik.com/products/silverlight/controls/tileview.aspx" title="Telerik">Telerik&#39;s TileView control</a>. It doesn&#39;t support hierachies out of the box, but we&#39;ve made a prototype control, which proves that the task is doable. Here is how nested TileView&#39;s look like:
<img src="/2012/03/13/multi-level-teleriks-tileview//tileview.png" alt="Tile view" title="Tile view"></p>
<p>Everything works with templates and data binding, no dirty tricks needed. You can download the sample project with multi-level TileView&#39;s from <a href="https://skydrive.live.com/redir.aspx?cid=c010011792a4b538&amp;resid=C010011792A4B538!128&amp;parid=root" title="Multi-level TileView sample project">here</a>.</p>

    </div>

    <p>
      Like this post? Please share it!<br />
      <a href="https://twitter.com/share" class="twitter-share-button" data-via="mikhail.io" data-size="large" data-count="none">Tweet</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
    </p>

    See a mistake? <a href="https://github.com/kiwo/mikhailio-docpad/edit/master/src/documents/2012/03/13/multi-level-teleriks-tileview/index.html.md">Edit this post!</a><br />

    
    <div class="post-tags">
        Posted In: C#, Silverlight, Telerik, TileView, User Contol
    </div>
    
</article>

    <article class="post">
    <div class="post-date">Mar 1st, 2012</div>
    
    <h1><a href='/2012/03/01/books-that-ive-recently-read/'>Books that I've recently read</a></h1>
    
    <div class="post-content">
        <p><img src="/2012/03/01/books-that-ive-recently-read//stevejobsbook2.jpg" alt="Steve Jobs book" title="Steve Jobs book">
<strong>&quot;Steve Jobs&quot; </strong>by Walter Isaacson (<a href="http://www.amazon.com/Steve-Jobs-Walter-Isaacson/dp/1451648537" title="Steve Jobs on Amazon">link</a>)</p>
<p>I guess it&#39;s one of the most popular books in the world at the moment. The story of the most influential person in IT world ever, that reveals the intense personality and extraordinary talent.</p>
<p>I never used a single product of Apple company, but still I&#39;m very impressed with what Steve did and with the way how he did that. Now I understand that many things are possible, even if everyone <em>knows</em> they are not.</p>
<p>The book is pretty long and detailed, but it&#39;s worth the time. I rate it 4 out of 5.</p>
<p><img src="/2012/03/01/books-that-ive-recently-read//tinkov1.jpg" alt="Tinkov" title="Tinkov"> <strong>&quot;How to Become a Businessman&quot;</strong> by Oleg Tinkov (<a href="http://tinkov.com/payment/5/" title="Tinkov books">link</a>)</p>
<p>A book by the most famous Russian entrepreneur. Short, simple and sharp, it gives a portion of good advice for young businessmen.</p>
<p>To me it appeared to be really motivating. The main idea is &quot;keep your head clean and your work hard - and you&#39;ll earn your million&quot;.</p>
<p>The book is quite short (you&#39;ll probably finish it in one or two nights) and well structured (how to find the idea, make the brand, start, develop and sell the business) with real life example.</p>
<p>5 star reading for a rookie businessman in Russia.</p>
<p><img src="/2012/03/01/books-that-ive-recently-read//tinkov2.jpg" alt="Tinkov 2" title="Tinkov">
<strong>&quot;I&#39;m Just Like Anyone Else&quot;</strong> by Oleg Tinkov (<a href="http://itunes.apple.com/us/book/im-just-like-anyone-else/id407756421" title="Oleg Tinkov">link</a>)</p>
<p>Another book of same author. He didn&#39;t mean to teach the reader, but instead he tells the story of his life and all of his businesses to the moment.</p>
<p>The biography of strong entrepreneur and charismatic leader is definitely worth reading. And while doing that, you&#39;ll probably learn some hints and ideas on business in Russia.</p>
<p>Rating is 4*.</p>
<p><strong>
<img src="/2012/03/01/books-that-ive-recently-read//the_art_of_the_start.jpg" alt="" title="the_art_of_the_start">&quot;The Art of  the Start&quot;</strong> by Guy Kawasaki (<a href="http://www.guykawasaki.com/the-art-of-the-start/" title="Guy Kawasaki">link</a>)</p>
<p>Guy is a former evangelist for Apple&#39;s Macintosh computer and now - a Silicon Valley venture capitalist.</p>
<p>While he gives some generic valuable hints on start-up business, the book did not seem the right one for me at the moment. The author goes into great detail when it comes to raising capital, preparing awesome presentations and self-marketing.</p>
<p>You know, I don&#39;t expect myself to form the board of directors any soon... So I&#39;ll give this book 3*, as it&#39;s good but not relevant enough for my needs.</p>

    </div>

    <p>
      Like this post? Please share it!<br />
      <a href="https://twitter.com/share" class="twitter-share-button" data-via="mikhail.io" data-size="large" data-count="none">Tweet</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
    </p>

    See a mistake? <a href="https://github.com/kiwo/mikhailio-docpad/edit/master/src/documents/2012/03/01/books-that-ive-recently-read/index.html.md">Edit this post!</a><br />

    
    <div class="post-tags">
        Posted In: Books, Business books
    </div>
    
</article>

    <article class="post">
    <div class="post-date">Feb 28th, 2012</div>
    
    <h1><a href='/2012/02/28/gauge-control-with-two-values-silverlight/'>Gauge control with two values (Silverlight)</a></h1>
    
    <div class="post-content">
        <p>While developing the dashboard to display several performance indexes, I bumped into the task of visualizing the pair of numbers on a single gauge. One number would show a person&#39;s performance metric, while the other one would display the person group&#39;s performance indicator to compare with. I couldn&#39;t find a ready control to use, so I decided to design my own.</p>
<p>I took the look idea from <a href="http://www.fusioncharts.com/demos/gallery/gauges/chart.asp?id=linear_1" title="Fusion Chart gauge sample">Fusion Charts</a> flash controls (highly recommended), which I was using a couple of years ago:
<img src="/2012/02/28/gauge-control-with-two-values-silverlight//fusiongauge.png" alt="" title="FusionGauge"></p>
<p>I needed the same thing, but with two values displayed at the same time. Requirements are pretty simple:</p>
<ul>
<li>Three colored zones (low-red / average-yellow / high-green) with configurable thresholds</li>
<li>Configurable min and max values</li>
<li>One value marker on top of the gauge and another one on the bottom</li>
<li>Bubble with exact value next to each marker</li>
<li>All control properties are ready to be data-bound</li>
<li>Flexible size</li>
<li>No ticks needed
Here is what I ended up with:
<img src="/2012/02/28/gauge-control-with-two-values-silverlight//mygauge.png" alt="" title="MyGauge"></li>
</ul>
<p>Quite minimalistic and sexy ;-)  The control usage is self-explanatory:</p>
<pre><code>&lt;local:Gauge x:Name=&quot;Gauge&quot; Value=&quot;71&quot; SecondValue=&quot;84&quot; RedThreshold=&quot;60&quot; YellowThreshold=&quot;80&quot;
                 MinValue=&quot;0&quot; MaxValue=&quot;100&quot; Width=&quot;400&quot; /&gt;
</code></pre><p>Source code has no rocket-science inside, so I won&#39;t post it here. You can download the Gauge control test application <a href="https://skydrive.live.com/redir.aspx?cid=c010011792a4b538&amp;resid=C010011792A4B538!127&amp;parid=root">here</a>.</p>

    </div>

    <p>
      Like this post? Please share it!<br />
      <a href="https://twitter.com/share" class="twitter-share-button" data-via="mikhail.io" data-size="large" data-count="none">Tweet</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
    </p>

    See a mistake? <a href="https://github.com/kiwo/mikhailio-docpad/edit/master/src/documents/2012/02/28/gauge-control-with-two-values-silverlight/index.html.md">Edit this post!</a><br />

    
    <div class="post-tags">
        Posted In: gauge control, Silverlight, User Control
    </div>
    
</article>

    <article class="post">
    <div class="post-date">Feb 5th, 2012</div>
    
    <h1><a href='/2012/02/05/hunting-memory-leaks-in-silverlight/'>Hunting memory leaks in Silverlight</a></h1>
    
    <div class="post-content">
        <p>Recently, I&#39;ve spent a couple of days seeking and fixing memory leaks in our Silverlight application. It might be tough sometimes, but it&#39;s a good &#39;brain-teasing&#39; practice and it&#39;s a good way to learn how inner things work.</p>
<p>Memory leaks in Silverlight applications may be found with WinDbg tool. Have a look here for a quick introduction:
<a href="http://davybrion.com/blog/2009/08/finding-memory-leaks-in-silverlight-with-windbg/">http://davybrion.com/blog/2009/08/finding-memory-leaks-in-silverlight-with-windbg/</a></p>
<p>Basically, I only use 4 commands in WinDbg. First, I enable debugging Silverlight 5 applications:</p>
<pre><code>!load C:\Program Files (x86)\Microsoft Silverlight\5.0.61118.0\sos.dll
</code></pre><p>Then, I get the amount of instances for class names matching the search pattern:</p>
<pre><code>!dumpheap -stat -type &lt;type name&gt;
</code></pre><p>Next, I use the result to locate class instances&#39; addresses:</p>
<pre><code>!dumpheap -MT &lt;MT from previous&gt;
</code></pre><p>Finally, I get the reference chain for each of address found:</p>
<pre><code>!gcroot &lt;address&gt;
</code></pre><p>Having done this, you&#39;ll have to turn your brain on and try to figure out whether you found a memory leak and why if yes, why it takes place. Here are several examples of memory leaks that I found during last session:</p>
<ol>
<li>HtmlPage.Document.AttachEvent() call, which was never detached. We were using some browser-level API to subscribe on HTML document events, and never cared about unsubscribing. I got it refactored to native Silverlight event handlers, and this solved the issue.</li>
<li>Deriving from MultiScaleTileSource. We used to have several classes for map layer rendering, inherited from MultiScaleTileSource. If an instance of such class is never used for map rendering (no assignment to MultiScaleImage.Source), then the GC never collects it (together with everything it references, of course). Another portion of refactoring helped: do not derive from MultiScaleTileSource whenever it&#39;s not needed for MultiScaleImage population. Sounds trivial, right? But it helps a lot.</li>
<li>Improper usage of CompositionTarget.Rendering event. For our custom animated Progress control, we used to subscribe to CompositionTarget.Rendering in control constructor, and then animated the progress in event handler. As the Progress control used to be a part of control tree (in Expanded/Collapsed state), the event was never unsubsribed, which means... ta-dam... a memory leak. Now I use CompositionTarget.Rendering more carefully: subscribe to it at the point when Progress control is shown, and unsubscribe immediately after it gets collapsed.</li>
<li>One of our major controls used to fail to unsubscribe itself from global error handler. There were a couple other similar event-related leaks. All fixed.</li>
<li><p>A weird Telerik-related leak. We actively use RadGridView control throughout our application, and we dynamically set HeaderCellStyle for some of the columns depending on grid configuration. Unexpectedly enough, this led to a memory leak with the following reference stack:</p>
<p> HandleTable:</p>
<pre><code> 02f311f4 (pinned handle)
 -&gt; 11ee6210 System.Object[]
 -&gt; 10f21690 OurNamespace.Utilities.AppletHelper
 -&gt; 10f21670 System.EventHandler`1[[OurNamespace.Utilities.EventArgs`1[[System.Exception, mscorlib]], OurNamespace.Utilities]]
 -&gt; 10f2103c QFVClient.App
 -&gt; 1111a9bc QFVClient.PageContainer
 -&gt; 11122138 System.Collections.Generic.Dictionary`2[[MS.Internal.IManagedPeerBase, System.Windows],[System.Object, mscorlib]]
 -&gt; 11122184 System.Collections.Generic.Dictionary`2+Entry[[MS.Internal.IManagedPeerBase, System.Windows],[System.Object, mscorlib]][]
 -&gt; 1188ba6c System.Windows.Controls.Grid
 -&gt; 1188bad4 System.Collections.Generic.Dictionary`2[[MS.Internal.IManagedPeerBase, System.Windows],[System.Object, mscorlib]]
 -&gt; 118912d8 System.Collections.Generic.Dictionary`2+Entry[[MS.Internal.IManagedPeerBase, System.Windows],[System.Object, mscorlib]][]
 -&gt; 11122dc8 System.Windows.Controls.Border
 -&gt; 11122e30 System.Collections.Generic.Dictionary`2[[MS.Internal.IManagedPeerBase, System.Windows],[System.Object, mscorlib]]
 -&gt; 11122e7c System.Collections.Generic.Dictionary`2+Entry[[MS.Internal.IManagedPeerBase, System.Windows],[System.Object, mscorlib]][]
 -&gt; 11128ea4 System.Windows.Controls.Grid
 -&gt; 11128f0c System.Collections.Generic.Dictionary`2[[MS.Internal.IManagedPeerBase, System.Windows],[System.Object, mscorlib]]
 -&gt; 11128f58 System.Collections.Generic.Dictionary`2+Entry[[MS.Internal.IManagedPeerBase, System.Windows],[System.Object, mscorlib]][]
 -&gt; 11128fa4 System.Windows.Controls.Border
 -&gt; 1112900c System.Collections.Generic.Dictionary`2[[MS.Internal.IManagedPeerBase, System.Windows],[System.Object, mscorlib]]
 -&gt; 11129058 System.Collections.Generic.Dictionary`2+Entry[[MS.Internal.IManagedPeerBase, System.Windows],[System.Object, mscorlib]][]
 -&gt; 11132e00 System.Windows.Controls.Grid
 -&gt; 11132e68 System.Collections.Generic.Dictionary`2[[MS.Internal.IManagedPeerBase, System.Windows],[System.Object, mscorlib]]
 -&gt; 11135bc4 System.Collections.Generic.Dictionary`2+Entry[[MS.Internal.IManagedPeerBase, System.Windows],[System.Object, mscorlib]][]
 -&gt; 11133758 QFVClient.Controls.SearchBox
 -&gt; 11133ca8 System.Collections.Generic.Dictionary`2[[MS.Internal.IManagedPeerBase, System.Windows],[System.Object, mscorlib]]
 -&gt; 11133cf4 System.Collections.Generic.Dictionary`2+Entry[[MS.Internal.IManagedPeerBase, System.Windows],[System.Object, mscorlib]][]
 -&gt; 11133c40 System.Windows.ResourceDictionary
 -&gt; 11133d30 System.Collections.Generic.Dictionary`2[[MS.Internal.IManagedPeerBase, System.Windows],[System.Object, mscorlib]]
 -&gt; 11133d7c System.Collections.Generic.Dictionary`2+Entry[[MS.Internal.IManagedPeerBase, System.Windows],[System.Object, mscorlib]][]
 -&gt; 11133e18 System.Windows.Style
 -&gt; 11133e68 System.Collections.Generic.Dictionary`2[[MS.Internal.IManagedPeerBase, System.Windows],[System.Object, mscorlib]]
 -&gt; 11133eb4 System.Collections.Generic.Dictionary`2+Entry[[MS.Internal.IManagedPeerBase, System.Windows],[System.Object, mscorlib]][]
 -&gt; 11133ef0 System.Collections.Generic.Dictionary`2[[System.UInt32, mscorlib],[System.Windows.DependencyObject, System.Windows]]
 -&gt; 11133f3c System.Collections.Generic.Dictionary`2+Entry[[System.UInt32, mscorlib],[System.Windows.DependencyObject, System.Windows]][]
 -&gt; 110dced0 System.Windows.Style
 -&gt; 110dcf20 System.Collections.Generic.Dictionary`2[[MS.Internal.IManagedPeerBase, System.Windows],[System.Object, mscorlib]]
 -&gt; 110dcf6c System.Collections.Generic.Dictionary`2+Entry[[MS.Internal.IManagedPeerBase, System.Windows],[System.Object, mscorlib]][]
 -&gt; 110dce6c System.Windows.SetterBaseCollection
 -&gt; 110dcfa8 System.Collections.Generic.Dictionary`2[[MS.Internal.IManagedPeerBase, System.Windows],[System.Object, mscorlib]]
 -&gt; 110dcff4 System.Collections.Generic.Dictionary`2+Entry[[MS.Internal.IManagedPeerBase, System.Windows],[System.Object, mscorlib]][]
 -&gt; 110dcd0c System.Windows.Setter
 -&gt; 110dcd5c System.Collections.Generic.Dictionary`2[[MS.Internal.IManagedPeerBase, System.Windows],[System.Object, mscorlib]]
 -&gt; 110dcda8 System.Collections.Generic.Dictionary`2+Entry[[MS.Internal.IManagedPeerBase, System.Windows],[System.Object, mscorlib]][]
 -&gt; 110dcde4 System.Collections.Generic.Dictionary`2[[System.UInt32, mscorlib],[System.Windows.DependencyObject, System.Windows]]
 -&gt; 110dce30 System.Collections.Generic.Dictionary`2+Entry[[System.UInt32, mscorlib],[System.Windows.DependencyObject, System.Windows]][]
 -&gt; 110dcad0 System.Windows.Controls.ControlTemplate
 -&gt; 110dcb34 System.Windows.ResourceDictionary
 -&gt; 110dd0d8 MS.Internal.ResourceDictionaryCollection
 -&gt; 110dd21c System.Collections.Generic.Dictionary`2[[MS.Internal.IManagedPeerBase, System.Windows],[System.Object, mscorlib]]
 -&gt; 1111609c System.Collections.Generic.Dictionary`2+Entry[[MS.Internal.IManagedPeerBase, System.Windows],[System.Object, mscorlib]][]
 -&gt; 110df418 System.Windows.ResourceDictionary
 -&gt; 110df470 System.Collections.Generic.Dictionary`2[[MS.Internal.IManagedPeerBase, System.Windows],[System.Object, mscorlib]]
 -&gt; 110eb8b4 System.Collections.Generic.Dictionary`2+Entry[[MS.Internal.IManagedPeerBase, System.Windows],[System.Object, mscorlib]][]
 -&gt; 110ecde0 System.Windows.Style
 -&gt; 116d1cd4 OurNamespace.Controls.TextColumn
</code></pre></li>
</ol>
<p>PageContainer is the application container which always exists, while TextColumn is a custom column class for a Telerik grid, which is already removed from application tree at the time point. Our TextColumn gets bound with root controls through ResourceDictionary/Style chain; and I can&#39;t explain the reason of such a leak. Though, clearing HeaderCellStyle when grid is not needed anymore does fix the problem. Weird enough.</p>
<p>As you can see, there are numerous reasons for memory leaks in a Silverlight application. Some are obvious (e.g. global event handlers never unsubscribed), other ones are hard to understand intuitively and sometimes depend on runtime or third party internals. In any case, a way to fix or workaround always exists. Good luck with bug hunting!</p>

    </div>

    <p>
      Like this post? Please share it!<br />
      <a href="https://twitter.com/share" class="twitter-share-button" data-via="mikhail.io" data-size="large" data-count="none">Tweet</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
    </p>

    See a mistake? <a href="https://github.com/kiwo/mikhailio-docpad/edit/master/src/documents/2012/02/05/hunting-memory-leaks-in-silverlight/index.html.md">Edit this post!</a><br />

    
    <div class="post-tags">
        Posted In: C#, fixing memory leaks, Memory leaks, Silverlight, WinDbg
    </div>
    
</article>

    <article class="post">
    <div class="post-date">Feb 1st, 2012</div>
    
    <h1><a href='/2012/02/01/machine-learning-class-at-stanford-online/'>Machine Learning class at Stanford online</a></h1>
    
    <div class="post-content">
        <p>Several days ago, I&#39;ve received a Statement of Accomplishment document from Andrew Ng and Machine Learning online class team.
<img src="/2012/02/01/machine-learning-class-at-stanford-online//mlstatement.png" alt="" title="MLStatement"></p>
<p>My score is below the maximum just because I started about two weeks late, and thus got a penalty for first exercises.</p>
<p>Overall, that was a great experience of online learning, thanks to Andrew and his team. If you still haven&#39;t heard of Stanford online courses, please visit <a href="http://http://www.ml-class.org" title="Machine Learning class">Machine Learning class page</a>. There you&#39;ll also find the list of other classes to be available soon, I&#39;m already signed to some of them.</p>
<p>Join, it&#39;s gonna be fun!</p>

    </div>

    <p>
      Like this post? Please share it!<br />
      <a href="https://twitter.com/share" class="twitter-share-button" data-via="mikhail.io" data-size="large" data-count="none">Tweet</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
    </p>

    See a mistake? <a href="https://github.com/kiwo/mikhailio-docpad/edit/master/src/documents/2012/02/01/machine-learning-class-at-stanford-online/index.html.md">Edit this post!</a><br />

    
    <div class="post-tags">
        Posted In: Machine Learning, Online Classes, Online Learning, Stanford, Statement of Accomplishment
    </div>
    
</article>

    <article class="post">
    <div class="post-date">Jan 26th, 2012</div>
    
    <h1><a href='/2012/01/26/speech-bubble-control-in-sl/'>Speech bubble custom border control in Silverlight</a></h1>
    
    <div class="post-content">
        <p>Recently, I was trying to find a Silverlight control, which works like a standard Border, but looks like a Speech Bubble instead. This means the border would have a &quot;leader&quot; triangle, which could point to a related visual element. See the following example:</p>
<p><img src="/2012/01/26/speech-bubble-control-in-sl//bubbles.png" alt="Speech bubbles on a map" title="Speech bubbles on a map"></p>
<p>Here we have two objects on a map: two vehicle icons. Each of them has a related bubble pop-up with some status information. When we get many objects on the map, the pop-up &quot;leaders&quot; will help user grasp the relations between icons and info labels.</p>
<p>First, I started with requirements list to a Bubble control; here&#39;s what I got:</p>
<ol>
<li>The control should act like a standard content control, i.e. it must allow any like of XAML content inside.</li>
<li>It must auto scale up and down whenever the content size changes.</li>
<li>The &quot;leader&quot; position must be flexible: I need a way to switch it to appear on the left, on the right or totally hidden in design/runtime. I also need to set &quot;leader&quot; top position and size.</li>
<li>The control look must be customizable with styles/templates. The look from the picture above should be doable, which means I need a way to setup background opacity, border color (make sure the &quot;leader&quot; and pop-up body has a unite border) and solid shadow.</li>
<li>It must be open source, free to use and modify for a commercial application.</li>
</ol>
<p>Unfortunately, I failed to find a ready-to-use control on the web, so I had to write one on my own. You can download the Bubble control test application <a href="https://skydrive.live.com/redir.aspx?cid=c010011792a4b538&amp;resid=C010011792A4B538!126&amp;parid=root">here</a>. 
Here is a brief review of the code.</p>
<p>First, we declare the Bubble control and derive from ContentControl to get a ready-to-use Content property for placing child control.</p>
<pre><code>public class Bubble : ContentControl
{
    public Bubble()
    {
        this.DefaultStyleKey = typeof(Bubble);
    }
}
</code></pre><p>Then, we go to Themes/Generic.xaml resource dictionary to declare the (default) control template. Here&#39;s how it looks:</p>
<pre><code>&lt;Setter Property=&quot;Template&quot;&gt;
    &lt;Setter.Value&gt;
        &lt;ControlTemplate TargetType=&quot;localcontrols:Bubble&quot;&gt;
            &lt;Grid&gt;
                &lt;Path x:Name=&quot;OuterPath&quot; Fill=&quot;#020202&quot; StrokeThickness=&quot;0&quot; Opacity=&quot;0.7&quot;&gt;
                    &lt;Path.Effect&gt;
                        &lt;BlurEffect Radius=&quot;6&quot;/&gt;
                    &lt;/Path.Effect&gt;
                &lt;/Path&gt;
                &lt;Path x:Name=&quot;InnerPath&quot; Stroke=&quot;#8F8F8F&quot; StrokeThickness=&quot;1&quot;&gt;
                &lt;/Path&gt;
                &lt;ContentPresenter x:Name=&quot;ContentContainer&quot; ContentTemplate=&quot;{TemplateBinding ContentTemplate}&quot; Content=&quot;{TemplateBinding Content}&quot;
                                    HorizontalAlignment=&quot;Center&quot; VerticalAlignment=&quot;Center&quot; /&gt;
            &lt;/Grid&gt;
        &lt;/ControlTemplate&gt;
    &lt;/Setter.Value&gt;
&lt;/Setter&gt;
</code></pre><p>The three elements are placed into ControlTemplate:</p>
<ul>
<li>OuterPath is a Path control to render background and shadow. I didn&#39;t manage to get the exact required look with a single Path control with DropShadowEffect, so I decided to use two controls instead. We apply Fill, Opacity and BlurEffect to this control.</li>
<li>InnerPath is a Path control to render the border. We apply Stroke and StrokeThickness to this control.</li>
<li>ContentContainer is a ContentPresenter to render child control hierarchy.</li>
</ul>
<p>Now, we can get the references to template&#39;s controls in our Bubble&#39;s method OnApplyTemplate(). We are going to render the bubble with Path controls, with pixel-based API. So, any time the content size changes, we need to adopt Paths. Let&#39;s subscribe to SizeChanged event then.</p>
<pre><code>private Path _OuterPath;
private Path _InnerPath;
private ContentPresenter _ContentContainer;

public override void OnApplyTemplate()
{
    base.OnApplyTemplate();
    _OuterPath = (Path)GetTemplateChild(&quot;OuterPath&quot;);
    _InnerPath = (Path)GetTemplateChild(&quot;InnerPath&quot;);
    _ContentContainer = (ContentPresenter)GetTemplateChild(&quot;ContentContainer&quot;);
    if (_OuterPath != null &amp;&amp; _ContentContainer != null)
        _ContentContainer.SizeChanged += new SizeChangedEventHandler(OnSizeChanged);
}

private void OnSizeChanged(object sender, SizeChangedEventArgs e)
{
    Render();
}
</code></pre><p>We&#39;ll need several properties to customize the look of Bubble control: Corner radius and Leader size &amp; position.</p>
<pre><code>/// &lt;summary&gt;
/// Corner radius
/// &lt;/summary&gt;
public static readonly DependencyProperty CornerRadiusProperty = DependencyProperty.Register(&quot;CornerRadius&quot;, typeof(int), typeof(Bubble), new PropertyMetadata(null));
public int CornerRadius
{
    get
    {
        return (int)GetValue(CornerRadiusProperty);
    }
    set
    {
        SetValue(CornerRadiusProperty, value);
    }
}

/// &lt;summary&gt;
/// Leader (arrow pointer) size
/// &lt;/summary&gt;
public static readonly DependencyProperty LeaderSizeProperty = DependencyProperty.Register(&quot;LeaderSize&quot;, typeof(int), typeof(Bubble), new PropertyMetadata(null));
public int LeaderSize
{
    get
    {
        return (int)GetValue(LeaderSizeProperty);
    }
    set
    {
        SetValue(LeaderSizeProperty, value);
    }
}

/// &lt;summary&gt;
/// Leader (arrow pointer) position - relative to upper border
/// &lt;/summary&gt;
public static readonly DependencyProperty LeaderTopProperty = DependencyProperty.Register(&quot;LeaderTop&quot;, typeof(int), typeof(Bubble), new PropertyMetadata(null));
public int LeaderTop
{
    get
    {
        return (int)GetValue(LeaderTopProperty);
    }
    set
    {
        SetValue(LeaderTopProperty, value);
    }
}

/// &lt;summary&gt;
/// Leader (arrow pointer) position - left, right or none (hidden)
/// &lt;/summary&gt;
public static readonly DependencyProperty LeaderPositionProperty = DependencyProperty.Register(&quot;LeaderPosition&quot;, typeof(BubbleLeaderPosition), typeof(Bubble), new PropertyMetadata(OnPropertyChanged));
public BubbleLeaderPosition LeaderPosition
{
    get
    {
        return (BubbleLeaderPosition)GetValue(LeaderPositionProperty);
    }
    set
    {
        SetValue(LeaderPositionProperty, value);
    }
}

public enum BubbleLeaderPosition
{
    None,
    Left,
    Right
}
</code></pre><p>Now we only need to implement Render() method - quite a lot of routine work: calculating coordinates of &quot;leader&quot;, adding Path segments into both OuterPath and InnerPath, setting margins etc.</p>
<pre><code>protected void Render()
{
    if (_ContentContainer == null &#39;&#39; _OuterPath == null)
                return;
    double width = _ContentContainer.ActualWidth + 2 + SHADOW_SIZE * 2 + LeaderSize;
    double height = _ContentContainer.ActualHeight + 2 + SHADOW_SIZE * 2;

    // paint the outer path - used for shadow effect
    RenderPath(_OuterPath, 0, 0, width, height, SHADOW_SIZE);

    // paint the inner path - used for border rendering
    // may be skipped in control template
    if (_InnerPath != null)
        RenderPath(_InnerPath, SHADOW_SIZE, SHADOW_SIZE, width - SHADOW_SIZE, height - SHADOW_SIZE, 0);

    switch (LeaderPosition)
    {
        case BubbleLeaderPosition.None:
            _ContentContainer.Margin = new Thickness(SHADOW_SIZE + 1);
            break;
        case BubbleLeaderPosition.Left:
            _ContentContainer.Margin = new Thickness(LeaderSize + SHADOW_SIZE + 1, SHADOW_SIZE + 1, SHADOW_SIZE + 1, SHADOW_SIZE + 1);
            break;
        case BubbleLeaderPosition.Right:
            _ContentContainer.Margin = new Thickness(SHADOW_SIZE + 1, SHADOW_SIZE + 1, SHADOW_SIZE + 1 + LeaderSize, SHADOW_SIZE + 1);
            break;
    }
}

private void RenderPath(Path path, double left, double top, double right, double bottom, double shadowSize)
{
    PathGeometry geometry = new PathGeometry();
    PathFigure figure = new PathFigure { IsClosed = true };
    geometry.Figures.Add(figure);
    switch (LeaderPosition)
    {
        case BubbleLeaderPosition.None:
            figure.StartPoint = new Point { X = left, Y = top + CornerRadius };
            figure.Segments.Add(new ArcSegment { Point = new Point { X = left + CornerRadius, Y = top }, SweepDirection = SweepDirection.Clockwise, Size = new Size { Width = CornerRadius, Height = CornerRadius } });
            figure.Segments.Add(new LineSegment { Point = new Point { X = right - CornerRadius, Y = top } });
            figure.Segments.Add(new ArcSegment { Point = new Point { X = right, Y = top + CornerRadius }, SweepDirection = SweepDirection.Clockwise, Size = new Size { Width = CornerRadius, Height = CornerRadius } });
            figure.Segments.Add(new LineSegment { Point = new Point { X = right, Y = bottom - CornerRadius } });
            figure.Segments.Add(new ArcSegment { Point = new Point { X = right - CornerRadius, Y = bottom }, SweepDirection = SweepDirection.Clockwise, Size = new Size { Width = CornerRadius, Height = CornerRadius } });
            figure.Segments.Add(new LineSegment { Point = new Point { X = left + CornerRadius, Y = bottom } });
            figure.Segments.Add(new ArcSegment { Point = new Point { X = left, Y = bottom - CornerRadius }, SweepDirection = SweepDirection.Clockwise, Size = new Size { Width = CornerRadius, Height = CornerRadius } });
            break;

        case BubbleLeaderPosition.Left:
            figure.StartPoint = new Point { X = left + LeaderSize, Y = top + CornerRadius };
            figure.Segments.Add(new ArcSegment { Point = new Point { X = left + LeaderSize + CornerRadius, Y = top }, SweepDirection = SweepDirection.Clockwise, Size = new Size { Width = CornerRadius, Height = CornerRadius } });
            figure.Segments.Add(new LineSegment { Point = new Point { X = right - CornerRadius, Y = top } });
            figure.Segments.Add(new ArcSegment { Point = new Point { X = right, Y = top + CornerRadius }, SweepDirection = SweepDirection.Clockwise, Size = new Size { Width = CornerRadius, Height = CornerRadius } });
            figure.Segments.Add(new LineSegment { Point = new Point { X = right, Y = bottom - CornerRadius } });
            figure.Segments.Add(new ArcSegment { Point = new Point { X = right - CornerRadius, Y = bottom }, SweepDirection = SweepDirection.Clockwise, Size = new Size { Width = CornerRadius, Height = CornerRadius } });
            figure.Segments.Add(new LineSegment { Point = new Point { X = left + LeaderSize + CornerRadius, Y = bottom } });
            figure.Segments.Add(new ArcSegment { Point = new Point { X = left + LeaderSize, Y = bottom - CornerRadius }, SweepDirection = SweepDirection.Clockwise, Size = new Size { Width = CornerRadius, Height = CornerRadius } });
            figure.Segments.Add(new LineSegment { Point = new Point { X = left + LeaderSize, Y = top + LeaderTop + 2 * LeaderSize + 2 * shadowSize } });
            figure.Segments.Add(new LineSegment { Point = new Point { X = left, Y = top + LeaderTop + LeaderSize + shadowSize } });
            figure.Segments.Add(new LineSegment { Point = new Point { X = left + LeaderSize, Y = top + LeaderTop } });
            break;

        case BubbleLeaderPosition.Right:
            figure.StartPoint = new Point { X = left, Y = top + CornerRadius };
            figure.Segments.Add(new ArcSegment { Point = new Point { X = left + CornerRadius, Y = top }, SweepDirection = SweepDirection.Clockwise, Size = new Size { Width = CornerRadius, Height = CornerRadius } });
            figure.Segments.Add(new LineSegment { Point = new Point { X = right - LeaderSize - CornerRadius, Y = top } });
            figure.Segments.Add(new ArcSegment { Point = new Point { X = right - LeaderSize, Y = top + CornerRadius }, SweepDirection = SweepDirection.Clockwise, Size = new Size { Width = CornerRadius, Height = CornerRadius } });
            figure.Segments.Add(new LineSegment { Point = new Point { X = right - LeaderSize, Y = top + LeaderTop } });
            figure.Segments.Add(new LineSegment { Point = new Point { X = right, Y = top + LeaderTop + LeaderSize + shadowSize } });
            figure.Segments.Add(new LineSegment { Point = new Point { X = right - LeaderSize, Y = top + LeaderTop + 2 * LeaderSize + 2 * shadowSize } });
            figure.Segments.Add(new LineSegment { Point = new Point { X = right - LeaderSize, Y = bottom - CornerRadius } });
            figure.Segments.Add(new ArcSegment { Point = new Point { X = right - LeaderSize - CornerRadius, Y = bottom }, SweepDirection = SweepDirection.Clockwise, Size = new Size { Width = CornerRadius, Height = CornerRadius } });
            figure.Segments.Add(new LineSegment { Point = new Point { X = left + CornerRadius, Y = bottom } });
            figure.Segments.Add(new ArcSegment { Point = new Point { X = left, Y = bottom - CornerRadius }, SweepDirection = SweepDirection.Clockwise, Size = new Size { Width = CornerRadius, Height = CornerRadius } });
            break;
    }

    path.Data = geometry;
}
</code></pre><p>You can download the Bubble control test application <a href="https://skydrive.live.com/redir.aspx?cid=c010011792a4b538&amp;resid=C010011792A4B538!126&amp;parid=root">here</a>. It will show you something like this :)
<img src="/2012/01/26/speech-bubble-control-in-sl//bubblegirls.png" alt="Bubble girls" title="Bubble girls"></p>

    </div>

    <p>
      Like this post? Please share it!<br />
      <a href="https://twitter.com/share" class="twitter-share-button" data-via="mikhail.io" data-size="large" data-count="none">Tweet</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
    </p>

    See a mistake? <a href="https://github.com/kiwo/mikhailio-docpad/edit/master/src/documents/2012/01/26/speech-bubble-control-in-sl/index.html.md">Edit this post!</a><br />

    
    <div class="post-tags">
        Posted In: C#, Silverlight, Speech Bubble, User Control, WPF
    </div>
    
</article>


<div id="me">
    <p>
        <img src="/images/Headshot-Square.jpg" alt="Mikhail Shilkov" />
        I'm <b>Mikhail Shilkov</b>, a software developer. I enjoy C#, Javascript and SQL development and I blog about my experience on this website.
    </p>
    <p>
        <a href="https://www.linkedin.com/in/mikhailshilkov/">LinkedIn</a> &#8226;
        <a href="http://twitter.com/kiwo22">@kiwo22</a> &#8226;
        <a href="https://github.com/kiwo">GitHub</a> &#8226;
        <a href="http://stackoverflow.com/users/1171619/mikhail">Stack Overflow</a>
    </p>
</div>

</div>
<div class="container">
    <div class="navbar navbar-footer">
        <p class="navbar-center navbar-text">Content copyright &copy; 2015 Mikhail Shilkov</p>
    </div>
</div>



<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="//netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.pack.js"></script>
<script src="/vendor/highlight.pack.js"></script>
<script src="/site.js"></script>

<script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-342471-4']);
    _gaq.push(['_setDomainName', 'mikhail.io']);
    _gaq.push(['_trackPageview']);
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
</script>

</body>
</html>